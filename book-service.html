<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="bower_components/core-ajax/core-ajax.html">

<polymer-element name="book-service" attributes="query books npage">

    <template>
      <core-ajax
      id="ajax"
      url="http://it-ebooks-api.info/v1/search/{{query}}/page/{{npage}}"
      handleAs="json"
      on-core-response="{{handleResponse}}"></core-ajax>

      <ul>
        <template repeat="{{book in books}}">
          <li>
            <h3>{{book.Title}}</h3>
            <img src="{{book.Image}}">
            <p>{{book.Description}}</p>
          </li>
        </template>
      </ul>

    </template>

    <script>
      Polymer('book-service', {
        query: null,
        npage: 1,

        ready: function() {
          this.books = [];
        },
      
        observe: {
          query: 'search',
          npage: 'search'
        },

        search: function(){
          this.$.ajax.go();
        },

        handleResponse: function(){
          var result = this.$.ajax.response;
          if (result && result.Books) {
            this.books = result.Books;
          } else{
            this.books = [];
          }
        }

      });
    </script>

</polymer-element>