<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="bower_components/core-ajax/core-ajax.html">
<link rel="import" href="bower_components/paper-fab/paper-fab.html">
<link rel="import" href="bower_components/paper-toast/paper-toast.html">

<polymer-element name="book-service" attributes="query npage books">

    <template>
      <style>
        ul {
          display: block;
          margin: 0 auto;
          padding: 0;
          width: 100%;
        }
        li{
          max-width: 650px;
          display: block;
          margin: 25px auto 25px auto;
          background: #fff;
          padding: 0 20px 20px 20px;
          border-radius: 8px;
          overflow: hidden;
        }
        li img{
          float: left;
          margin-right: 15px;
        }

        paper-fab.green {
          background: #259b24;
          color: #fff;
        }

        paper-toast{
          height: 30px;
          top: 12px !important;
        }
      </style>
      
      <core-ajax
      id="ajax"
      url="http://it-ebooks-api.info/v1/search/{{query}}/page/{{npage}}"
      handleAs="json"
      on-core-response="{{handleResponse}}"></core-ajax>

      <paper-toast id="toast" text="We found {{result.Total}} books about {{query}}"></paper-toast>

      <ul>
        <template repeat="{{book in books}}">
          <li>
            <h3>{{book.Title}}</h3>
            <img src="{{book.Image}}">
            <p>{{book.Description}}</p>
            <paper-fab class="green" data-id="{{book.ID}}" icon="arrow-forward" on-click="{{getlinkdownload}}"></paper-fab>
          </li>
        </template>
      </ul>

    </template>

    <script>
      Polymer('book-service', {
        query: null,
        npage: 1,

        ready: function() {
          this.books = [];
        },

        getlinkdownload: function(event, detail, sender){         
          var bookdialog = document.querySelector('book-dialog');
          bookdialog.rundialog(sender.getAttribute("data-id"));
        },

        observe: {
          query: 'search',
          npage: 'search'
        },

        search: function(){
          this.$.ajax.go();
        },

        handleResponse: function(){
          this.result = this.$.ajax.response;
          if (this.result && this.result.Books) {
            this.books = this.result.Books;
            this.$.toast.show();
          } else{
            this.books = [];
          }
          console.log(this.books);
        }

      });
    </script>

</polymer-element>